Resetting local database...
Recreating database...
Initialising schema...
Seeding globals from roles.sql...
Skipping migration seed_engagement_events.sql... (file name must match pattern "<timestamp>_name.sql")
Skipping migration test_rls_engagement_events.sql... (file name must match pattern "<timestamp>_name.sql")
Applying migration 20240716220000_ai_token_usage.sql...
Applying migration 20240722115000_shared_audit_function.sql...
Applying migration 20240722120000_v1.6.1_profiles.sql...
NOTICE (00000): policy "profiles_owner_select" for relation "public.profiles" does not exist, skipping
NOTICE (00000): policy "profiles_owner_insert" for relation "public.profiles" does not exist, skipping
NOTICE (00000): trigger "audit_profiles" for relation "public.profiles" does not exist, skipping
Applying migration 20241201000000_engagement_events.sql...
NOTICE (42710): extension "uuid-ossp" already exists, skipping
Applying migration 20241215000000_momentum_meter.sql...
NOTICE (42710): extension "uuid-ossp" already exists, skipping
Applying migration 20241216000000_intervention_triggers.sql...
NOTICE (00000): trigger "momentum_intervention_trigger" for relation "daily_engagement_scores" does not exist, skipping
Applying migration 20241217000000_score_calculation_scheduler.sql...
NOTICE (42710): extension "pg_net" already exists, skipping
Applying migration 20241217000001_realtime_momentum_triggers.sql...
NOTICE (00000): policy "Users can view own momentum scores" for relation "daily_engagement_scores" does not exist, skipping
NOTICE (00000): policy "Coaches can view all interventions" for relation "coach_interventions" does not exist, skipping
Applying migration 20241217000002_data_validation_error_handling.sql...
Applying migration 20241217000003_performance_optimization.sql...
NOTICE (42P07): relation "idx_daily_scores_user_date" already exists, skipping
NOTICE (42P07): relation "idx_notifications_user_date" already exists, skipping
NOTICE (42P07): relation "idx_notifications_status" already exists, skipping
NOTICE (42P07): relation "idx_notifications_type_date" already exists, skipping
NOTICE (42P07): relation "idx_interventions_user_date" already exists, skipping
Applying migration 20241220_push_notification_triggers.sql...
NOTICE (00000): trigger "momentum_change_notification_trigger" for relation "daily_engagement_scores" does not exist, skipping
Applying migration 20241227000001_create_momentum_tables.sql...
NOTICE (42P07): relation "daily_engagement_scores" already exists, skipping
NOTICE (42P07): relation "momentum_notifications" already exists, skipping
Applying migration 20241227000002_fcm_token_management.sql...
NOTICE (00000): FCM Token Management migration completed successfully
NOTICE (00000): Created tables: user_fcm_tokens, notification_delivery_log
NOTICE (00000): Created functions: upsert_fcm_token, get_user_fcm_tokens, cleanup_expired_fcm_tokens, deactivate_fcm_token
Applying migration 20241228000000_today_feed_content.sql...
Applying migration 20241228000001_content_review_system.sql...
Applying migration 20241229000000_content_analytics_monitoring.sql...
Applying migration 20241229000001_content_versioning_system.sql...
Applying migration 20241230000000_enhanced_content_moderation.sql...
Applying migration 20241230000001_cdn_performance_optimization.sql...
Applying migration 20250102000001_wearable_live_metrics.sql...
Applying migration 20250106000001_conversation_logs.sql...
Applying migration 20250106000002_coaching_effectiveness.sql...
Applying migration 20250106000003_cross_patient_patterns.sql...
Applying migration 20250107000000_daily_content_scheduler.sql...
NOTICE (42710): extension "pg_cron" already exists, skipping
NOTICE (42710): extension "pg_net" already exists, skipping
Applying migration 20250107000001_fix_trigger_action_type.sql...
Applying migration 20250109000000_wearable_health_data.sql...
NOTICE (42710): extension "uuid-ossp" already exists, skipping
Applying migration 20250115000000_wearable_live_enriched.sql...
NOTICE (42710): extension "uuid-ossp" already exists, skipping
Applying migration 20250120000000_security_fixes.sql...
NOTICE (00000): policy "Service role can manage system logs" for relation "public.system_logs" does not exist, skipping
NOTICE (00000): policy "Users can view own realtime metrics" for relation "public.realtime_event_metrics" does not exist, skipping
NOTICE (00000): policy "Service role can manage realtime metrics" for relation "public.realtime_event_metrics" does not exist, skipping
NOTICE (00000): policy "Users can view own error logs" for relation "public.momentum_error_logs" does not exist, skipping
NOTICE (00000): policy "Service role can manage error logs" for relation "public.momentum_error_logs" does not exist, skipping
NOTICE (00000): drop cascades to view intervention_effectiveness_summary
NOTICE (00000): view "intervention_effectiveness_summary" does not exist, skipping
WARNING (01006): no privileges could be revoked for "auth"
WARNING (01006): no privileges could be revoked for "auth"
Applying migration 20250120000001_complete_security_definer_fix.sql...
Applying migration 20250120000002_force_remove_security_definer.sql...
Applying migration 20250612184447_add_full_content_column.sql...
Applying migration 20250615010000_add_steps_hrv_to_wearable_daily_summary.sql...
NOTICE (42701): column "steps_total" of relation "wearable_daily_summary" already exists, skipping
NOTICE (42701): column "hrv_avg" of relation "wearable_daily_summary" already exists, skipping
Applying migration 20250616120000_coach_interactions.sql...
NOTICE (42710): extension "uuid-ossp" already exists, skipping
Applying migration 20250616120500_coach_interactions_view.sql...
Applying migration 20250616121000_coach_interactions_realtime.sql...
NOTICE (00000): trigger "coach_interactions_realtime_trigger" for relation "public.coach_interactions" does not exist, skipping
Applying migration 20250616122000_coach_interaction_metrics.sql...
Applying migration 20250616123000_jitai_reward_log.sql...
Applying migration 20250616123500_coach_interaction_embedding.sql...
NOTICE (00000): ivfflat index created with little data
Applying migration 20250617000000_wearable_summary_trigger.sql...
NOTICE (00000): trigger "trg_wearable_summary_notify" for relation "public.wearable_daily_summary" does not exist, skipping
Applying migration 20250617000500_api_latency_table.sql...
Applying migration 20250617150000_allow_service_role_coaching_effectiveness.sql...
NOTICE (00000): policy "service_role_insert" for relation "public.coaching_effectiveness" does not exist, skipping
Applying migration 20250617150500_allow_service_role_full_coaching_effectiveness.sql...
NOTICE (00000): policy "service_role_full" for relation "public.coaching_effectiveness" does not exist, skipping
Applying migration 20250617151000_conversation_logs_user_policies.sql...
NOTICE (00000): policy "user_select" for relation "public.conversation_logs" does not exist, skipping
NOTICE (00000): policy "user_insert" for relation "public.conversation_logs" does not exist, skipping
Applying migration 20250617151500_conversation_logs_select_authenticated.sql...
NOTICE (00000): policy "user_select_auth" for relation "public.conversation_logs" does not exist, skipping
Applying migration 20250617152000_enable_rls_for_phi_tables.sql...
Applying migration 20250617153000_enable_rls_phi_if_exists.sql...
Applying migration 20250619120000_security_fixes_view_rls.sql...
Applying migration 20250622140000_allow_multiple_runs_per_day.sql...
Applying migration 20250624000500_use_app_settings_for_generator_url.sql...
NOTICE (42701): column "updated_at" of relation "app_settings" already exists, skipping
Applying migration 20250624190000_security_fixes.sql...
Applying migration 20250624190500_fix_view_security.sql...
Applying migration 20250624191500_fix_view_security_invoker_option.sql...
Applying migration 20250628173000_coach_helpful_rate_view.sql...
Applying migration 20250701090000_create_analytics_events.sql...
Applying migration 20250704120000_coach_conversations.sql...
NOTICE (42710): extension "uuid-ossp" already exists, skipping
Applying migration 20250704194500_add_conversation_id.sql...
Applying migration 20250704221500_fix_content_generation_function.sql...
Applying migration 20250704223000_fix_url_fallback.sql...
Applying migration 20250705120000_prune_daily_feed_content.sql...
Applying migration 20250705130000_drop_unique_daily_feed_content_content_date.sql...
Applying migration 20250708120000_onboarding_schema.sql...
NOTICE (42710): extension "pgcrypto" already exists, skipping
NOTICE (00000): policy "medical_history_owner_select" for relation "public.medical_history" does not exist, skipping
NOTICE (00000): policy "medical_history_owner_crud" for relation "public.medical_history" does not exist, skipping
NOTICE (00000): policy "biometrics_owner_select" for relation "public.biometrics" does not exist, skipping
NOTICE (00000): policy "biometrics_owner_crud" for relation "public.biometrics" does not exist, skipping
NOTICE (00000): policy "ers_owner_select" for relation "public.energy_rating_schedules" does not exist, skipping
NOTICE (00000): policy "ers_owner_crud" for relation "public.energy_rating_schedules" does not exist, skipping
NOTICE (00000): trigger "audit_medical_history" for relation "public.medical_history" does not exist, skipping
NOTICE (00000): trigger "audit_biometrics" for relation "public.biometrics" does not exist, skipping
NOTICE (00000): trigger "audit_energy_rating_schedules" for relation "public.energy_rating_schedules" does not exist, skipping
Applying migration 20250708121000_onboarding_responses.sql...
NOTICE (00000): trigger "onboarding_user_autocreate" for relation "public.onboarding_responses" does not exist, skipping
NOTICE (42710): extension "pgcrypto" already exists, skipping
NOTICE (00000): policy "onboarding_responses_owner_select" for relation "public.onboarding_responses" does not exist, skipping
NOTICE (00000): policy "onboarding_responses_owner_crud" for relation "public.onboarding_responses" does not exist, skipping
NOTICE (00000): trigger "audit_onboarding_responses" for relation "public.onboarding_responses" does not exist, skipping
Applying migration 20250708122000_onboarding_responses_rls.sql...
Applying migration 20250708123000_onboarding_responses_audit_trigger.sql...
WARN: no files matched pattern: supabase/seed.sql
Restarting containers...
Finished supabase db reset on branch debug/migration-failure.
A new version of Supabase CLI is available: v2.30.4 (currently installed v2.28.1)
We recommend updating regularly for new features and bug fixes: https://supabase.com/docs/guides/cli/getting-started#updating-the-supabase-cli
