---
description: 
globs: 
alwaysApply: true
---
---
description: Core coding & architecture guidelines for the BEEâ€‘MVP mobile app
globs:
  # Apply to all Flutter code and Supabase Edge Functions
  - lib/**
  - functions/**
  - docs/ai_coach/**
alwaysApply: false        # Use â€œ@ bee_mvpâ€ in chat or let Cursor autoâ€‘attach
---

# ğŸ Behavioral Engagement Engine (BEE) â€“ Project Rules

## 1. Architecture Snapshot
- Follow the layered stack in *docs/bee_mvp_architecture.md*Â mvp_architecture.md](file-service://file-Ra6TfA4BVuecxGgx68euF1)  
  - Clientâ€¯â†’â€¯Supabase Edgeâ€¯Functionâ€¯`aiâ€‘coaching-engine`â€¯â†’â€¯Claude/OpenAI â†’ Postgres  
  - Future migration path: Hasura + CloudÂ Run once BAA signed.
- Keep **p95 API latency <â€¯1â€¯s**; target 30â€¯req/min/user burst.
## 2. Folder & Naming Conventions
| Layer | Path | Notes |
|-------|------|-------|
| Features | `lib/features/{feature}/` | One folder per **Feature** (Momentumâ€¯Meter, Todayâ€¯Feed, etc.) |
| Shared | `lib/core/` | Reusable widgets, services, utilities |
| Edge Functions | `functions/{functionâ€‘name}/` | Deno + Supabase CLI |
| Docs | `docs/` | All markdown specs; one README per epic |

> **Rule:** If a file grows beyond ~300Â LOC or mixes UI, data and business logic, *split it*.

## 3. Coding Standards
- **SDK:** FlutterÂ 3.3.2a  
- **State:** Riverpod v2  
- **Sizing & Colors:** import `responsive_services.dart` & `theme.dart` â€“ *no magic numbers*  
- **Null safety** everywhere (`--fatal-warnings` in CI).  
- **SemVer tags** for Edge Functions.

## 4. Testing Policy
- Aim for **â‰¥â€¯85â€¯% coverage** on core logic, **â‰¤â€¯5â€¯%** golden/generic snapshot files. 
- Keep tests as simple as is reasonable focusing on core business logic
- Use `flutter_test` + `mocktail`; integration tests in `test_driver/`.  
- For each new public service method create *one* happyâ€‘path test and critical edgeâ€‘case tests only.

## 5. AI Coach Guardâ€‘Rails
*(Autoâ€‘attach when working in `lib/features/ai_coach/**` or `functions/ai-coaching-engine/**`)*

```yaml
globs:
  - lib/features/ai_coach/**
  - functions/ai-coaching-engine/**
alwaysApply: true
