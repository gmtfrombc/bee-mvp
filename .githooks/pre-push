#!/usr/bin/env bash
set -e

# Prevent infinite loop if hook triggered by automated CI.
if [[ -n "$CI" ]]; then
  exit 0
fi

# Use the lightweight CI target for quick feedback before pushing.
echo "🚦 Pre-push: running lightweight local CI (make ci-lite)…"

if ! make ci-lite; then
  echo "❌️ Local CI failed – push aborted. Fix issues and commit again."
  exit 1
fi

echo "✅ ci-lite passed – proceeding with push." 